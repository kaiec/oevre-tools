$ = require "jquery"
exec = require("child_process").exec

module.exports.chooseDirectory = (callback) ->
  $("body").append('<input style="display:none;" id="file1Dialog" type="file" nwdirectory />');
  chooser = $("#file1Dialog");
  chooser.change( (evt) ->
    callback($(this).val())
    $(this).remove();
  )
  chooser.trigger('click')

module.exports.chooseFile = (callback) ->
  $("body").append('<input style="display:none;" id="file2Dialog" type="file" />');
  chooser = $("#file2Dialog");
  chooser.change( (evt) ->
    callback($(this).val())
    $(this).remove();
  )
  chooser.trigger('click')

module.exports.chooseFileSave = (callback) ->
  $("body").append('<input style="display:none;" id="file3Dialog" type="file" nwsaveas />');
  chooser = $("#file3Dialog");
  chooser.change( (evt) ->
    callback($(this).val())
    $(this).remove();
  )
  chooser.trigger('click')



module.exports.printObject = (object) ->
  result = "{ "
  for own key, value of object
    result += key
    result += ": \""
    result += value
    result += "\"; "
  result += " }"
  return result


module.exports.readExif = (tag, file) ->
  exec = require('child_process').exec
  exec("", (err, str) ->
    if (err)
      return fn(err)
    obj = str.split('\n').reduce((obj, line)->
      i = line.indexOf(':');
      key = slug(line.slice(0, i));
      val = line.slice(i + 1, line.length).trim();
      if ('' == key || '' == val) then return obj
      obj[key] = val
      return obj
    )
  )


_exec = (command, callback) ->
  exec(command,callback)

async = require("async")
queue = async.queue(_exec, 16)

module.exports.exec = (command, callback) ->
  queue.push(command, callback)


module.exports.log = require("./log")
module.exports.xml = require("./xml")
